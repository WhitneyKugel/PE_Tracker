<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PE Tracker</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/styles/styles.css" type="text/css">
  </head>
  <body>
    <div id="main">
      <h1>PE Tracker</h1>
      <% tasks.forEach(function(r) {%>
        <h2><%= r.name %></h2>

        <button onClick='javascript:start();'>
          Start
        </button>

        <button id='<%= r.id %>'
          onClick='javascript:logTask("<%= r.id %>");'>
          Stop
        </button>

        <div id="rank">
        
          <%= r.id %>   
        
        </div>
        
        <br>
      <% }); %>

    </div>

    <script>
      let currentTaskId = null;
      var startTime, endTime, seconds;

      function start() {
        startTime = new Date();
      };

      function end() {
        endTime = new Date();
        var timeDiff = (endTime - startTime) / 1000;

        seconds = Math.round(timeDiff);
        console.log(seconds + " seconds");
      }

      const logTask = async function(id) {
        end();
        const response = await fetch('/log', { 
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            users_id: -1,
            students_id: -1,
            tasks_id: id,
            duration: seconds
          })
        });
        const result = await response.json();
        console.log(result);
        currentTaskId = id;
      }
    </script>
  </body>
</html>